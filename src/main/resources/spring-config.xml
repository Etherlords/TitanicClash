<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
    <context:annotation-config />
    <context:component-scan base-package="*"/>

    <!-- Net configuration -->
    <bean class="utils.io.IntOperator" id="IntOperator"/>
    <bean class="utils.io.DoubleOperator" id="DoubleOperator"/>
    <bean class="utils.io.PointOperator" id="PointOperator"/>
    <bean class="utils.io.UTFStringOperator" id="UTFStringOperator"/>

    <bean id="HeaderOperator" class="utils.io.StreamOperator">
        <property name="serializers">
            <array value-type="utils.io.ISerializer">
                <ref bean="IntOperator"/>
                <ref bean="IntOperator"/>
            </array>
        </property>
        <property name="deserializers">
            <array value-type="utils.io.IDeserializer">
                <ref bean="IntOperator"/>
                <ref bean="IntOperator"/>
            </array>
        </property>
    </bean>


    <bean id="LoginOperator" class="utils.io.StreamOperator">
        <property name="serializers">
            <array value-type="utils.io.IDeserializer">
                <!-- login -->
                <ref bean="UTFStringOperator"/>
                <!-- password -->
                <ref bean="UTFStringOperator"/>
            </array>
        </property>
    </bean>

    <bean id="LoginAnswerOperator" class="utils.io.StreamOperator">
        <!-- status -->
        <property name="deserializers">
            <array value-type="utils.io.IDeserializer">
                <!--id-->
                <ref bean="IntOperator"/>
                <!--status-->
                <ref bean="IntOperator"/>
            </array>
        </property>
    </bean>

    <bean id="ChatMessageOperator" class="utils.io.StreamOperator">
        <property name="serializers">
            <array value-type="utils.io.ISerializer">
                <!-- userid -->
                <ref bean="IntOperator"/>
                <!-- mesasge group -->
                <ref bean="IntOperator"/>
                <!-- message -->
                <ref bean="UTFStringOperator"/>
            </array>
        </property>
        <property name="deserializers">
            <array value-type="utils.io.IDeserializer">
                <!-- userid -->
                <ref bean="IntOperator"/>
                <!-- mesasge group -->
                <ref bean="IntOperator"/>
                <!-- message -->
                <ref bean="UTFStringOperator"/>
            </array>
        </property>
    </bean>

    <bean class="net.packets.BytePacket" id="PingPacket">
        <property name="type" value="0"/>
        <property ref="HeaderOperator" name="headerOperator"/>
    </bean>

    <bean id="LoginAnswer" class="net.packets.BytePacket">
        <property name="type" value="2"/>
        <property name="headerOperator" ref="HeaderOperator"/>
        <property name="streamOperator" ref="LoginAnswerOperator"/>
    </bean>

    <bean id="LoginPacket" class="net.packets.BytePacket">
        <property name="type" value="3"/>
        <property name="headerOperator" ref="HeaderOperator"/>
        <property name="streamOperator" ref="LoginOperator"/>
    </bean>

    <bean id="ChatMessage" class="net.packets.BytePacket">
        <property name="type" value="1"/>
        <property name="headerOperator" ref="HeaderOperator"/>
        <property name="streamOperator" ref="ChatMessageOperator"/>
    </bean>

    <bean class="net.DataReader" id="DataReaders">
        <property name="readers">
            <array value-type="net.packets.BytePacket">
                <ref bean="LoginPacket"/>
                <ref bean="PingPacket"/>
                <ref bean="ChatMessage"/>
            </array>
        </property>
    </bean>

    <bean class="game.Lobby" id="Lobby" init-method="initialize">
        <property name="chatMessage" ref="ChatMessage"/>
        <property name="sessionManager" ref="SessionManager"/>
    </bean>

    <bean class="net.Server" id="MainServerManager">
        <constructor-arg name="dataReader" ref="DataReaders"/>
        <constructor-arg name="dataRouter" ref="SocketDataRouter"/>
        <constructor-arg name="sessionManager" ref="SessionManager"/>
    </bean>
    <!-- end of net config -->

    <bean class="logic.SessionManager" id="SessionManager"/>

    <bean class="events.ChatMessageEventHandler" id="ChatMessageEvent" depends-on="ChatMessage">
        <property name="typeFromPacket" ref="ChatMessage"/>
        <property name="sessionManager" ref="SessionManager"/>
    </bean>

    <bean class="events.LoginEventHandler" id="LoginEvent" depends-on="LoginPacket">
        <property name="sessionMManager" ref="SessionManager"/>
        <property name="typeFromPacket" ref="LoginPacket"/>
        <property name="loginAnswerPacket" ref="LoginAnswer"/>
        <property name="lobby" ref="Lobby"/>
    </bean>

    <bean class="net.events.SocketDataEventRouter" id="SocketDataRouter">
        <property name="listeners">
            <array value-type="net.events.IBytePacketDataEventListener">
                <ref bean="LoginEvent"/>
                <ref bean="ChatMessageEvent"/>
            </array>
        </property>
    </bean>



</beans>